{% extends "base.html" %}

{% block title %}Dashboard - GMO Bot Manager{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<div class="grid">
    <!-- Status Card -->
    <div class="card" id="status-card" hx-get="{{ url_for('dashboard.status_partial') }}" hx-trigger="every 10s" hx-swap="innerHTML">
        {% include "partials/status_card.html" %}
    </div>

    <!-- Control Panel -->
    <div class="card">
        <h2>Control Panel</h2>
        <div class="control-buttons">
            {% if status.is_running %}
                <button class="btn btn-warning" hx-post="{{ url_for('bot_control.api_stop') }}" hx-swap="none" hx-on::after-request="htmx.trigger('#status-card', 'refresh')">
                    Stop Bot
                </button>
                <button class="btn btn-primary" hx-post="{{ url_for('bot_control.api_restart') }}" hx-swap="none" hx-on::after-request="htmx.trigger('#status-card', 'refresh')">
                    Restart Bot
                </button>
            {% else %}
                <button class="btn btn-success" hx-post="{{ url_for('bot_control.api_start') }}" hx-swap="none" hx-on::after-request="htmx.trigger('#status-card', 'refresh')">
                    Start Bot
                </button>
            {% endif %}
        </div>
    </div>
</div>

<!-- P&L Summary -->
{% if pnl %}
<div class="card">
    <h2>P&L Summary</h2>
    <div class="pnl-summary">
        <div class="pnl-item">
            <span class="pnl-label">Actual P&L</span>
            <span class="pnl-value">{{ pnl.actual_profit_loss }} JPY</span>
        </div>
        <div class="pnl-item">
            <span class="pnl-label">Unrealized</span>
            <span class="pnl-value">{{ pnl.profit_loss }} JPY</span>
        </div>
    </div>
    <a href="{{ url_for('pnl.pnl_page') }}" class="btn btn-link" style="margin-top: 0.5rem;">View Chart</a>
</div>
{% endif %}

<!-- Recent Logs -->
<div class="card" id="logs-card">
    <h2>Recent Logs</h2>
    <div id="log-entries" hx-get="{{ url_for('dashboard.logs_partial') }}" hx-trigger="every 10s" hx-swap="innerHTML">
        {% include "partials/log_entries.html" %}
    </div>
    <a href="{{ url_for('logs.logs_page') }}" class="btn btn-link">View All Logs</a>
</div>
{% endblock %}
